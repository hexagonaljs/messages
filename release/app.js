var __t;__t=function(ns){var curr,index,part,parts,_i,_len;curr=null,parts=[].concat=ns.split(".");for(index=_i=0,_len=parts.length;_i<_len;index=++_i){part=parts[index];if(curr===null){curr=eval(part);continue}curr[part]==null?curr=curr[part]={}:curr=curr[part]}return curr};var models=window.models={},App,Glue,Gui,LocalStorage,UseCase,__hasProp={}.hasOwnProperty,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};_.defaults(this,{Before:function(a,b,c){return YouAreDaBomb(a,b).before(c)},BeforeAnyCallback:function(a,b,c){return YouAreDaBomb(a,b).beforeAnyCallback(c)},After:function(a,b,c){return YouAreDaBomb(a,b).after(c)},Around:function(a,b,c){return YouAreDaBomb(a,b).around(c)},AfterAll:function(a,b,c){var d,e,f,g;g=[];for(e=0,f=b.length;e<f;e++)d=b[e],g.push(After(a,d,c));return g},LogAll:function(a){var b,c,d;d=[];for(b in a){if(!__hasProp.call(a,b))continue;c=a[b],_.isFunction(c)?d.push(function(b){return Before(a,b,function(){return console.log("calling: "+b)})}(b)):d.push(void 0)}return d},AutoBind:function(a,b){var c,d,e;e=[];for(c in a)d=a[c],_.isFunction(d)?e.push(function(c){if(c.endsWith("Clicked")&&b[c.remove("Clicked")])return After(a,c,function(a){return b[c.remove("Clicked")](a)})}(c)):e.push(void 0);return e}}),LocalStorage=function(){function a(){this.messageSaved=__bind(this.messageSaved,this),this.saveMessage=__bind(this.saveMessage,this),this.messagesLoaded=__bind(this.messagesLoaded,this),this.loadMessages=__bind(this.loadMessages,this),this.flush=__bind(this.flush,this),this.remove=__bind(this.remove,this),this.get=__bind(this.get,this),this.set=__bind(this.set,this),this.set("messages",new Messages)}return a.prototype.set=function(a,b){return console.log(b),this[a]=b},a.prototype.get=function(a){return this[a]},a.prototype.remove=function(a){return this[a]=void 0},a.prototype.flush=function(){var a,b,c,d,e;d=$.jStorage.index(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push($.jStorage.deleteKey(a));return e},a.prototype.loadMessages=function(){var a=this;return this.get("messages").fetch({success:function(b){return a.messagesLoaded(b)}})},a.prototype.messagesLoaded=function(a){},a.prototype.saveMessage=function(a){var b,c=this;return b=this.get("messages").create(a.getValue()),b.save({success:function(a){return c.messageSaved(a)}})},a.prototype.messageSaved=function(a){},a}(),UseCase=function(){function a(){this.markMessageAsRead=__bind(this.markMessageAsRead,this),this.sendMessageButton=__bind(this.sendMessageButton,this),this.loginFail=__bind(this.loginFail,this),this.loginSuccess=__bind(this.loginSuccess,this),this.loginUser=__bind(this.loginUser,this),this.currentUser=__bind(this.currentUser,this),this.loginRequired=__bind(this.loginRequired,this),this.checkLogin=__bind(this.checkLogin,this),this.setMessages=__bind(this.setMessages,this),this.start=__bind(this.start,this)}return a.prototype.start=function(){return this.checkLogin()},a.prototype.setMessages=function(a){},a.prototype.checkLogin=function(){if(!this.currentUser())return this.loginRequired()},a.prototype.loginRequired=function(){},a.prototype.currentUser=function(){return this.user},a.prototype.loginUser=function(a,b){var c,d=this;return c=new User(a,b),c.login({success:function(a){return d.loginSuccess(a)},fail:function(a){return d.loginFail(a)}})},a.prototype.loginSuccess=function(a){return this.user=a},a.prototype.loginFail=function(a){return this.user=!1},a.prototype.sendMessageButton=function(a){},a.prototype.markMessageAsRead=function(a){},a}(),Gui=function(){function a(){this.userClickedSubmit=__bind(this.userClickedSubmit,this),this.removeLoginForm=__bind(this.removeLoginForm,this),this.showLoginPanel=__bind(this.showLoginPanel,this),this.messageClicked=__bind(this.messageClicked,this),this.sendMessageButtonClicked=__bind(this.sendMessageButtonClicked,this),this.createElementFor=__bind(this.createElementFor,this)}return a.prototype.createElementFor=function(a,b){var c,d,e,f;return e=$(a).html(),f=Handlebars.compile(e),d=f(b),c=$(d)},a.prototype.showMessage=function(a){var b;return b=this.createElementFor("#message-modal",a.toJSON()),$("body").append(b),b.modal("show")},a.prototype.showMessages=function(a){var b,c,d=this;return b=this.createElementFor("#messages-container"),c=b.find(".messages-list"),a.each(function(a){var b;return b=d.createElementFor("#message-template",a.toJSON()),b.find(".message-title").click(function(){return d.messageClicked(a)}),c.prepend(b)}),b.find("button").click(function(){return d.showMessageFrom()}),$(".main").empty(),$(".main").append(b)},a.prototype.showMessageFrom=function(){var a,b,c=this;return b=this.messageForm(),a=this.createElementFor("#new-message-modal"),a.find(".modal-body").append(b.el),a.find("#send-message-button").click(function(){return c.sendMessageButtonClicked(b),a.modal("hide")}),$("body").append(a),a.modal("show")},a.prototype.sendMessageButtonClicked=function(a){},a.prototype.messageClicked=function(a){},a.prototype.showLoginPanel=function(){var a,b=this;return a=this.createElementFor("#login-from"),$(".main").append(a),a.find("#login-button").click(function(){var c,d;return c=a.find("#email-address").val(),d=a.find("#password").val(),b.userClickedSubmit(c,d),!1})},a.prototype.messageForm=function(){var a;return a=new Backbone.Form({schema:{from:"Text",title:"Text",body:"TextArea"}}),a.render()},a.prototype.removeLoginForm=function(a){return $(".form-signin").remove()},a.prototype.userClickedSubmit=function(a,b){},a}(),Glue=function(){function a(a,b,c){var d=this;this.useCase=a,this.gui=b,this.storage=c,After(this.useCase,"loginRequired",function(){return d.gui.showLoginPanel()}),After(this.gui,"userClickedSubmit",function(a,b){return d.useCase.loginUser(a,b)}),After(this.useCase,"loginSuccess",function(a){return d.storage.loadMessages()}),After(this.useCase,"loginSuccess",function(a){return d.gui.removeLoginForm(a)}),After(this.storage,"messagesLoaded",function(a){return d.gui.showMessages(a)}),After(this.gui,"messageClicked",function(a){return d.useCase.markMessageAsRead(a)}),After(this.useCase,"markMessageAsRead",function(a){return d.gui.showMessage(a)}),After(this.gui,"sendMessageButtonClicked",function(a){return d.useCase.sendMessageButton(a)}),After(this.useCase,"sendMessageButton",function(a){return d.storage.saveMessage(a)}),After(this.storage,"saveMessage",function(a){return d.storage.loadMessages()}),LogAll(this.useCase),LogAll(this.gui)}return a}(),this.Message=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b}(Backbone.Model),this.Messages=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.localStorage=new Backbone.LocalStorage("messages"),b}(Backbone.Collection),this.User=function(){function a(a,b){this.email=a,this.password=b,this.login=__bind(this.login,this)}return a.prototype.login=function(a){if(a.success)return a.success(this)},a}(),App=function(){function a(){var a,b,c,d;d=new UseCase,b=new Gui,c=new LocalStorage,a=new Glue(d,b,c),d.start(),window.useCase=d}return a}(),window.app=new App